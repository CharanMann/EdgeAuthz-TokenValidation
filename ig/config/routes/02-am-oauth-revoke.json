{
  "baseURI": "${frConfigs.amUrl}",
  "condition": "${matches(request.uri.path, '^/am') and not contains(request.uri.path, 'token/revoke') }",
  "handler": {
    "type": "Chain",
    "config": {
      "filters": [
        {
          "comment": "Scripted filter for updating Redis cache",
          "name": "Shared cache updater",
          "type": "ScriptableFilter",
          "config": {
            "type": "application/x-groovy",
            "file": "SharedCacheUpdater.groovy",
            "args": {
              "cacheEndpoint": "redis://127.0.0.1:6379",
              "cacheSet": "tokenSet",
              "token": "${request.headers.token[0]}"
            }
          },
          "capture": "all"
        }
      ],
      "handler": "ClientHandler"
    },
    "capture": "all"
  }
}
